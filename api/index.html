<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Jaromil, DECODE project">
    
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>API - LUA Zenroom - blockchain language research in DECODE project</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Application protocol interface", url: "#application-protocol-interface", children: [
          ]},
          {title: "Crypto API", url: "#crypto-api", children: [
              {title: "Random", url: "#random" },
              {title: "Authenticated encryption", url: "#authenticated-encryption" },
              {title: "Curve25519-based key exchange", url: "#curve25519-based-key-exchange" },
              {title: "Blake2b cryptographic hash", url: "#blake2b-cryptographic-hash" },
              {title: "Ed25519 signature", url: "#ed25519-signature" },
              {title: "Argon2i password derivation", url: "#argon2i-password-derivation" },
          ]},
        ];

    </script>
    <script src="../js/base.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav">
      <a href="../design/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../design/" class="btn btn-xs btn-link">
        Design principles
      </a>
    </div>
    
  </div>

    

    <h1 id="application-protocol-interface">Application protocol interface</h1>
<p>This interpreter includes statically the following cryptographic
primitives, extracted from the NaCl library and included via the
monocypher/luanacha implementation:</p>
<ul>
<li>Authenticated encryption with Chacha20 stream encryption (more precisely Xchacha20, ie. Chacha with a 24-byte nonce) and Poly1305 MAC, </li>
<li>Curve25519-based key exchange and public key encryption,</li>
<li>Blake2b hash function,</li>
<li>Ed25519-based signature function using Blake2b hash instead of sha512,</li>
<li>Argon2i, a modern key derivation function based on Blake2b. Like scrypt, it is designed to be expensive in both CPU and memory.</li>
</ul>
<h1 id="crypto-api">Crypto API</h1>
<p>Here a summary of calls available. This API is subject to change and more functions will be added according to requirements for the implementation of attribute based cryptographi in DECODE.</p>
<h2 id="random">Random</h2>
<pre><code class="text">randombytes(n)
    return a string containing n random bytes
</code></pre>

<h2 id="authenticated-encryption">Authenticated encryption</h2>
<pre><code class="text">lock(key, nonce, plain [, prefix]) =&gt; crypted
    authenticated encryption using Xchacha20 and a Poly1305 MAC
    key must be a 32-byte string
    nonce must be a 24-byte string
    plain is the text to encrypt as a string
    prefix is an optional string. If it is provided, it is prepended 
    to the encrypted text. The prefix can be use for example to 
    store the nonce, and avoid extra string allocation and copying in 
    Lua applications. The prefix defaults to the empty string.
    Return the encrypted text as a string. The encrypted text includes 
    the 16-byte MAC. So #crypted == #plain + 16 + #prefix

    Note: the prefix is not an &quot;additional data&quot; in the AEAD sense.
    The MAC is computed over only the encrypted text. It does not include 
    the prefix.


unlock(key, nonce, crypted [, offset]) =&gt; plain
    authenticated decryption - verification of the Poly1305 MAC
    and decryption with Xcahcha20.
    key must be a 32-byte string
    nonce must be a 24-byte string
    crypted is the text to decrypt as a string
    offset is an optional integer. It is the length of the prefix used 
    by lock() if any. It defaults to 0.
    Return the decrypted text as a string or nil if the MAC 
    verification fails.

    Note: the responsibility of using matching prefix and offset belongs 
    to the application.
</code></pre>

<h2 id="curve25519-based-key-exchange">Curve25519-based key exchange</h2>
<pre><code class="text">public_key(sk) =&gt; pk
    return the public key associated to a curve25519 secret key
    sk is the secret key as a 32-byte string
    pk is the associated public key as a 32-byte string

keypair() =&gt; pk, sk
    generates a pair of curve25519 keys (public key, secret key)
    pk is the public key as a 32-byte string
    sk is the secret key as a 32-byte string

    Note: This is a convenience function:
        pk, sk = keypair()  --is equivalent to
        sk = randombytes(32); pk = public_key(sk)

key_exchange(sk, pk) =&gt; k
    DH key exchange. Return a session key k used to encrypt 
    or decrypt a text.
    sk is the secret key of the party invoking the function 
    (&quot;our secret key&quot;). 
    pk is the public key of the other party 
    (&quot;their public key&quot;).
    sk, pk and k are 32-byte strings
</code></pre>

<h2 id="blake2b-cryptographic-hash">Blake2b cryptographic hash</h2>
<pre><code class="text">blake2b_init([digest_size [, key]]) =&gt; ctx
    initialize and return a blake2b context object
    digest_size is the optional length of the expected digest. If provided,
    it must be an integer between 1 and 64. It defaults to 64.
    key is an optional key allowing to use blake2b as a MAC function.
    If provided, key is a string with a length that must be between 
    1 and 64. The default is no key.
    ctx is a pointer to the blake2b context as a light userdata.

blake2b_update(ctx, text_fragment)
    update the hash with a new text fragment
    ctx is a pointer to a blake2b context as a light userdata.

blake2b_final(ctx) =&gt; digest
    return the final value of the hash
    ctx is a pointer to a blake2b context as a light userdata.
    The digest is returned as a string. The length of the digest
    has been defined at the context creation (see blake2b_init()).
    It defaults to 64.

blake2b(text) =&gt; digest
    compute the hash of a string. 
    Returns a 64-byte digest.
    This is a convenience function which combines the init(), 
    update() and final() functions above.
</code></pre>

<h2 id="ed25519-signature">Ed25519 signature</h2>
<pre><code class="text">sign_public_key(sk) =&gt; pk
    return the public key associated to a secret key
    sk is the secret key as a 32-byte string
    pk is the associated public key as a 32-byte string

sign_keypair() =&gt; pk, sk
    generates a pair of ed25519 signature keys (public key, secret key)
    pk is the public signature key as a 32-byte string
    sk is the secret signature key as a 32-byte string

    Note: This is a convenience function:
        pk, sk = sign_keypair()     --is equivalent to
        sk = randombytes(32); pk = sign_public_key(sk)

sign(sk, text) =&gt; sig
    sign a text with a secret key
    sk is the secret key as a 32-byte string
    text is the text to sign as a string
    Return the text signature as a 64-byte string.

check(sig, pk, text) =&gt; is_valid
    check a text signature with a public key
    sig is the signature to verify, as a 64-byte string
    pk is the public key as a 32-byte string
    text is the signed text
    Return a boolean indicating if the signature is valid or not.

    Note: curve25519 key pairs (generated with keypair())
    cannot be used for ed25519 signature. The signature key pairs 
    must be generated with sign_keypair().
</code></pre>

<h2 id="argon2i-password-derivation">Argon2i password derivation</h2>
<pre><code class="text">argon2i(pw, salt, nkb, niter) =&gt; k
    compute a key given a password and some salt
    This is a password key derivation function similar to scrypt.
    It is intended to make derivation expensive in both CPU and memory.
    pw: the password string
    salt: some entropy as a string (typically 16 bytes)
    nkb:  number of kilobytes used in RAM (as large as possible)
    niter: number of iterations (as large as possible, &gt;= 10)
    Return k, a key string (32 bytes).

    For example: on a CPU i5 M430 @ 2.27 GHz laptop,
    with nkb=100000 (100MB) and niter=10, the derivation takes ~ 1.8 sec

</code></pre>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav">
      <a href="../design/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../design/" class="btn btn-xs btn-link">
        Design principles
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>